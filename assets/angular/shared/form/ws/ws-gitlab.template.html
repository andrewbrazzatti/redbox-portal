<div class="container">
  <div *ngIf="!field.wsUser.token" class="row">
    <form  #form="ngForm" (ngSubmit)="field.onLogin(field.username, field.password)" novalidate autocomplete="off">
      <h4>{{ field.permissionStep1 }}</h4>
      <div class="form-group">
        <label>Username</label>
        <input type="text" class="form-control" name="username" [(ngModel)]="field.username">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" class="form-control" name="password" [(ngModel)]="field.password">
      </div>
      <div class="form-group">
        <div *ngIf="field.loginMessageForm.message" class="alert alert-{{ field.loginMessageForm.class }}" class="form-group">
          {{ field.loginMessageForm.message }}
        </div>
      </div>
      <button class="btn btn-primary" type="submit">Login</button>
    </form>
  </div>
  <div *ngIf="field.wsUser.token" class="row mt-3 form-group">
    <table class="table">
      <thead>
        <tr>
          <ng-container *ngFor="let header of field.columns"><th>{{ header.label }}</th></ng-container>
          <th>RDMP</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of field.workspaces">
          <ng-container *ngFor="let column of field.columns">
            <td  *ngIf="column.show != false">
              <span *ngIf="column.link != null; else noProcessing "><a href="/{{ branding }}/{{ portal }}/{{ column.link.pattern}}"></a></span>
              <ng-template #multivalue></ng-template>
              <ng-template #noProcessing><span >{{ item[column.property] }}</span></ng-template>
            </td></ng-container>
            <td>
              <span *ngIf="item.rdmp.info && item.rdmp.info.rdmp; else isNotLinked ">
                <button disabled type="button" class="btn btn-success" *ngIf="item.rdmp.info.rdmp === field.rdmp"> Linked </button>
                <button disabled type="button" class="btn btn-info" *ngIf="item.rdmp.info.rdmp != field.rdmp"> Linked to another RDMP</button>
              </span>
              <ng-template #isNotLinked>
                <button type="button" class="btn btn-info" (click)="field.linkWorkspace(item.id)"> Link </button>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
      <div>
        <button type="button" class="btn btn-default" (click)="field.getWorkspacesRelated()"><i class="fa fa-refresh"></i>&nbsp;Sync</button>
        <button type="button" class="btn btn-success" (click)="field.createWorkspace()"><i class="fa fa-plus-square"></i>&nbsp;Create</button>
      </div>
    </div>
    <div style="display:none">
      <button type="button" class="btn btn-default" (click)="field.getWorkspacesRelated()"><i class="fa fa-refresh"></i>&nbsp;Sync</button>
    </div>
    <div *ngIf="field.wsUser.token" class="row mt-3 form-group">
      <button type="button" class="btn btn-danger" (click)="field.revokeModal()">{{ field.revokeMessage }}</button>
    </div>
    <div class="row mt-3 form-group">
      <button type="button" class="btn btn-default" (click)="field.sendToRDMP()">{{ field.backToRDMP }}</button>
    </div>
    <div id="gitlabPermissionModal" class="modal fade">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Requesting Permission</h4>
          </div>
          <div class="modal-body">
            <p>{{ field.permissionStep2 }}</p>
            <ul>
              <li *ngFor="let permission of field.permissionList">{{ permission }}</li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="field.allow()">Allow</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <div id="gitlabRevokeModal" class="modal fade">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Removing Permissions</h4>
          </div>
          <div class="modal-body">
            <p>{{ field.permissionRevoke }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="field.revoke()">Revoke</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <div id="gitlabLinkModal" class="modal fade">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Workspace Linking</h4>
          </div>
          <div class="modal-body">
            <h5>Workspace Details</h5>
            <p>name: {{ field.currentWorkspace.path_with_namespace }}</p>
            <p>web url: {{ field.currentWorkspace.web_url }}</p>
            <h5>Processing</h5>
            <p>Checking your master workspace link ...&nbsp;<span *ngIf="field.checks.master; then isDone; else isSpinning"></span></p>
            <p *ngIf="field.checks.comparing">Checking current links ...&nbsp;<span *ngIf="field.checks.link; then isDone; else isSpinning"></span></p>
            <p *ngIf="field.checks.link == false">No links, Linking to workspace ...&nbsp;<span *ngIf="field.checks.rdmp; then isDone; else isSpinning"></span></p>
            <p class="alert alert-success" *ngIf="field.checks.linkCreated">Your workspace was linked succesfully</p>
            <p class="alert alert-danger" *ngIf="field.checks.linkWithOther">Your workspace is linked with another RDMP</p>
            <ng-template #isDone>
              <i class="fa fa-check-circle"></i>
            </ng-template>
            <ng-template #isSpinning>
              <i class="fa fa-spinner fa-spin"></i>
            </ng-template>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
          </div>
        </div>
      </div>
    </div>
    <div id="gitlabCreateModal" class="modal fade">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Create Workspace</h4>
          </div>
          <div class="modal-body">
            <h5>Workspace Details</h5>
            <form *ngIf="!field.creation.created" #form="ngForm" (ngSubmit)="field.checkName()" novalidate autocomplete="off">
              <div class="form-group">
                <h4>Select Space</h4>
                <select class="form-control" [(ngModel)]="field.creation.group" name="creationNamespace">
                  <option *ngFor="let g of field.groups" [value]="g.name"
                  [selected]="field.creation.group === g.name">{{ g.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <h4>Name your workspace</h4>
                <input type="text" class="form-control" name="name" [(ngModel)]="field.creation.name">
              </div>
              <div class="form-group">
                <h4>Add a description</h4>
                <input type="text" class="form-control" name="description" [(ngModel)]="field.creation.description">
              </div>
              <div class="form-group">
                <div *ngIf="field.creation.message" class="alert alert-{{ field.loginMessageForm.class }}" class="form-group">
                  {{ null }}
                </div>
              </div>
              <div class="form-group">
                <button disabled class="btn btn-primary" type="submit">Check Name</button>
              </div>
              <div class="form-group">
                <div class="alert alert-success">Available&nbsp;<i class="fa fa-check-circle"></i></div>
              </div>
            </form>
            <form *ngIf="!field.creation.created" #form="ngForm" (ngSubmit)="field.create()" novalidate autocomplete="off">
              <div class="form-group">
                <h4>Select Template</h4>
                <select class="form-control" [(ngModel)]="field.creation.template" name="creationTemplate">
                  <option *ngFor="let t of field.templates" [value]="t.pathWithNamespace"
                  [selected]="field.creation.template === t.pathWithNamespace">{{ t.pathWithNamespace || 'No Template' }}</option>
                </select>
              </div>
              <div class="form-group">
                <div *ngIf="field.creation.message" class="alert alert-{{ field.creation.createdClass }}" class="form-group">
                  {{ field.creation.message }}
                </div>
              </div>
              <button class="btn btn-primary" type="submit">Create</button>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
